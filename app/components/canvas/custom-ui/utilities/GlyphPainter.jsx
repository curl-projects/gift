import styles from "./GlyphPainter.module.css"
import { motion, AnimatePresence } from "framer-motion"
import { useStarFireSync } from "~/components/synchronization/StarFireSync";

export function GlyphPainter(){
    const { glyphControls } = useStarFireSync();

    return(
        <>
        <AnimatePresence>
        {glyphControls.visible && (
        <>
            <div className={styles.glyphPainter}>
                <svg 
                    className={styles.glyph}
                    width="100vw" // Set the desired width
                    height="100vh" // Set the desired 
                    viewBox="0 0 250 250"
                    preserveAspectRatio="xMidYMid meet" // Center the SVG
                    filter="url(#pencilTexture4)"
                    // fill="url(#gradient)"
                    // initial={{ opacity: 0 }}
                    // animate={{ opacity: 1 }}
                    // exit={{ opacity: 0 }}
                    // transition={{ duration: 2, delay: 4 }}
                >
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
                            <stop offset="0%" style={{ stopColor: "#FF9A8B", stopOpacity: 1 }} />
                            <stop offset="100%" style={{ stopColor: "#FF6F61", stopOpacity: 1 }} />
                        </linearGradient>
                        <filter id="roughStroke" x="-20%" y="-20%" width="140%" height="140%">
                            <feTurbulence type="fractalNoise" baseFrequency="0.1" numOctaves="4" seed="2" result="noise"/>
                            <feDisplacementMap in="SourceGraphic" in2="noise" scale="20" xChannelSelector="R" yChannelSelector="G" result="displacedPath"/>
                            <feMorphology operator="dilate" radius="2" in="displacedPath" result="dilated"/>
                            <feGaussianBlur stdDeviation="2" in="dilated" result="blurred"/>
                            <feTurbulence type="turbulence" baseFrequency="0.05" numOctaves="2" result="turbulence"/>
                            <feDisplacementMap in="blurred" in2="turbulence" scale="10" xChannelSelector="R" yChannelSelector="G" result="finalPath"/>
                            <feComposite in="finalPath" in2="SourceGraphic" operator="atop"/>
                        </filter>

                        <clipPath id="innerStrokeClip">
                            <path
                                d="M 115.8 133.2 L 112.2 139.2 Q 102.15 154.432 91.299 163.561 A 70.659 70.659 0 0 1 85.3 168.1 A 57.99 57.99 0 0 1 71.43 175.075 A 47.397 47.397 0 0 1 56.2 177.6 A 41.177 41.177 0 0 1 45.231 176.049 A 54.528 54.528 0 0 1 37.4 173.2 A 59.921 59.921 0 0 1 23.431 164.35 A 71.771 71.771 0 0 1 19.1 160.4 A 65.634 65.634 0 0 1 6.498 142.82 A 75.55 75.55 0 0 1 5.3 140.3 A 59.792 59.792 0 0 1 0.334 121.258 A 73.133 73.133 0 0 1 0 114.2 Q 0 105.4 1.6 93.1 A 108.565 108.565 0 0 1 5.359 75.813 A 130.72 130.72 0 0 1 8.1 67.7 A 78.018 78.018 0 0 1 21.594 44.808 A 88.696 88.696 0 0 1 22.8 43.4 Q 30.702 34.435 46.915 19.466 A 978.975 978.975 0 0 1 58 9.4 A 237.142 237.142 0 0 1 63.325 4.844 A 266.537 266.537 0 0 1 65.2 3.3 A 25.636 25.636 0 0 1 67.134 1.858 Q 69.141 0.515 70.75 0.136 A 5.571 5.571 0 0 1 71.6 0 A 2.879 2.879 0 0 1 72.392 0.099 Q 73.6 0.446 73.6 2 Q 68.6 9.4 63.2 15.5 Q 57.8 21.6 51.4 28.3 A 737.517 737.517 0 0 0 46.319 33.677 Q 44.084 36.064 41.655 38.694 A 1315.019 1315.019 0 0 0 36.6 44.2 Q 31.6 51.4 28.9 60 Q 26.2 68.6 25.3 76.8 A 177.115 177.115 0 0 0 24.752 82.641 Q 24.532 85.522 24.449 88.067 A 90.768 90.768 0 0 0 24.4 91 A 89.5 89.5 0 0 0 25.568 105.139 A 107.784 107.784 0 0 0 26.9 112 Q 29.4 123 35 132.6 Q 40.6 142.2 49.6 148.2 A 34.794 34.794 0 0 0 62.128 153.285 A 48.639 48.639 0 0 0 71.8 154.2 A 73.905 73.905 0 0 0 80.067 153.771 Q 89.867 152.664 95.2 148.7 Q 102.6 143.2 102.6 129 Q 102.6 119.8 87.6 95 A 58.449 58.449 0 0 1 89.141 93.653 Q 90.894 92.168 93.347 90.272 A 193.139 193.139 0 0 1 93.7 90 Q 97.6 87 101.8 84 A 1290.399 1290.399 0 0 1 104.781 81.877 Q 107.125 80.213 109 78.9 A 345.124 345.124 0 0 1 109.709 78.405 Q 112.05 76.775 112.4 76.6 A 93.563 93.563 0 0 1 119.308 86.53 A 84.458 84.458 0 0 1 120.4 88.4 Q 123.8 94.4 127.1 99.5 Q 130.4 104.6 134.4 107.7 A 14.556 14.556 0 0 0 140.845 110.498 A 20.027 20.027 0 0 0 144.4 110.8 A 20.056 20.056 0 0 0 146.064 110.723 Q 147.817 110.576 150.203 110.148 A 76.213 76.213 0 0 0 151 110 Q 155.2 109.2 159.3 107.7 A 20.197 20.197 0 0 0 161.514 106.748 Q 163.875 105.547 165 104 Q 162.72 102.1 159.175 99.297 A 552.961 552.961 0 0 0 158.8 99 A 94.468 94.468 0 0 1 153.1 94.107 A 108.372 108.372 0 0 1 151.2 92.3 A 53.391 53.391 0 0 1 147.762 88.64 A 39.281 39.281 0 0 1 145 85 A 49.158 49.158 0 0 1 141.761 79.297 A 36.78 36.78 0 0 1 139.6 73.7 Q 138 68.2 138 62.2 A 20.871 20.871 0 0 1 138.413 58.215 Q 139.016 55.122 140.5 51.5 A 36.697 36.697 0 0 1 143.712 45.447 Q 145.756 42.3 148.6 39.1 A 45.898 45.898 0 0 1 155.976 32.487 A 61.616 61.616 0 0 1 163.2 28 A 90.746 90.746 0 0 1 163.675 27.907 Q 164.35 27.775 164.8 27.7 A 17.848 17.848 0 0 1 165.043 27.661 Q 165.373 27.611 165.538 27.602 A 1.174 1.174 0 0 1 165.6 27.6 A 18.268 18.268 0 0 1 172.197 28.889 Q 174.492 29.772 176.831 31.262 A 32.46 32.46 0 0 1 177.5 31.7 A 29.808 29.808 0 0 1 184.645 38.546 A 38.426 38.426 0 0 1 187.7 43.3 A 32.638 32.638 0 0 1 191.123 53.224 A 44.828 44.828 0 0 1 191.8 61.2 A 47.287 47.287 0 0 1 191.181 69.066 Q 190.412 73.624 188.686 77.356 A 26.759 26.759 0 0 1 187.4 79.8 A 8.268 8.268 0 0 0 188.379 80.625 Q 189.443 81.4 191.049 82.176 A 27.14 27.14 0 0 0 191.1 82.2 A 11.515 11.515 0 0 0 193.851 83.096 Q 195.098 83.343 196.53 83.39 A 20.686 20.686 0 0 0 197.2 83.4 A 21.545 21.545 0 0 0 201.807 82.939 Q 204.743 82.296 206.923 80.757 A 12.114 12.114 0 0 0 209 78.9 A 14.844 14.844 0 0 0 211.215 75.462 Q 212.963 71.833 214.024 66.06 A 75.262 75.262 0 0 0 214.6 62.4 A 14.197 14.197 0 0 1 214.963 60.301 Q 215.602 57.84 217.089 57.015 A 3.469 3.469 0 0 1 218.8 56.6 Q 221.8 56.6 221.8 61.6 Q 221.8 69.046 219.6 74.527 A 24.386 24.386 0 0 1 219 75.9 A 40.769 40.769 0 0 1 215.715 81.633 A 32.19 32.19 0 0 1 212.3 85.8 Q 208.4 89.8 205.2 93 Q 196.2 102 188.9 104.5 A 51.581 51.581 0 0 1 182.814 106.198 Q 179.714 106.85 176.889 106.972 A 29.829 29.829 0 0 1 175.6 107 A 15.494 15.494 0 0 1 174.854 106.984 Q 173.811 106.933 173.389 106.728 A 0.693 0.693 0 0 1 173.2 106.6 Q 171.617 107.233 169.534 109.808 A 32.557 32.557 0 0 0 168.4 111.3 Q 165.6 115.2 162.1 119.6 A 30.404 30.404 0 0 1 158.826 123.136 A 22.019 22.019 0 0 1 154.6 126.2 A 42.17 42.17 0 0 1 140.834 131.922 Q 135.215 133.216 128.685 133.377 A 76.141 76.141 0 0 1 126.8 133.4 Q 123.4 132.8 121.6 132.6 A 78.653 78.653 0 0 0 120.87 132.522 Q 119.669 132.4 119.2 132.4 A 13.354 13.354 0 0 0 118.149 132.439 Q 117.071 132.524 116.423 132.8 A 1.951 1.951 0 0 0 115.8 133.2 Z M 176.6 73.6 L 177.2 69.4 Q 174.644 48.635 168.006 44.454 A 6.644 6.644 0 0 0 164.4 43.4 A 7.72 7.72 0 0 0 162.472 43.626 A 5.095 5.095 0 0 0 159.6 45.5 A 7.46 7.46 0 0 0 158.317 48.23 Q 158 49.486 158 51 Q 158 54 161.5 59.9 A 39.614 39.614 0 0 0 166.608 66.66 A 51.209 51.209 0 0 0 171.2 71 Q 174.4 73.6 176.6 73.6 Z" 
                                
                            />
                        </clipPath>
                    </defs>
                    {/* <g id="svgGroup" 
                    // strokeLinecap="round" 
                    // fillRule="evenodd" 
                    // fontSize="9pt" 
                    // stroke="url(#gradient)" 
                    // strokeWidth="0.25mm" 
                    // fill="url(#gradient)" 
                    // style={{ stroke: "url(#gradient)", strokeWidth: "0.25mm"}}
                    > */}
                        <motion.path 
                            // stroke="#FF9A8B"
                            // stroke="url(#gradient)"
                            // filter="url(#roughStroke)"
                            key="glyph-path"
                            fill="url(#gradient)"
                            stroke="url(#gradient)"
                            strokeWidth="5"
                            // filter="url(#roughStroke)"
                            initial={{ pathLength: 0, fillOpacity: 0, opacity: 0, }}
                            animate={{ 
                                pathLength: glyphControls.visible ? [0, 0.01, 1] : [0, 0, 0], 
                                fillOpacity: glyphControls.visible ? [0, 0.01, 0.7] : [0, 0, 0], 
                                opacity: glyphControls.visible ? [0, 0.6, 1] : [0, 0, 0]
                            }}
                            exit={{ opacity: 0 }}
                            transition={{ 
                                duration: glyphControls.immediate ? 0 : (glyphControls.duration || 4), 
                                delay: glyphControls.delay || 0,
                                times: [0, 0.01, 1],
                                ease: "easeInOut"
                            
                            }}
                            strokeLinecap="round"
                            strokeLinejoin="round"
                            onAnimationComplete={(animation) => {
                                console.log('animation complete', animation)
                                if(animation.pathLength[animation.pathLength.length - 1] === 1){
                                    glyphControls.onComplete && glyphControls.onComplete();
                                }
                            }}
                            // clipPath="url(#innerStrokeClip)"
                            d="M 115.8 133.2 L 112.2 139.2 Q 102.15 154.432 91.299 163.561 A 70.659 70.659 0 0 1 85.3 168.1 A 57.99 57.99 0 0 1 71.43 175.075 A 47.397 47.397 0 0 1 56.2 177.6 A 41.177 41.177 0 0 1 45.231 176.049 A 54.528 54.528 0 0 1 37.4 173.2 A 59.921 59.921 0 0 1 23.431 164.35 A 71.771 71.771 0 0 1 19.1 160.4 A 65.634 65.634 0 0 1 6.498 142.82 A 75.55 75.55 0 0 1 5.3 140.3 A 59.792 59.792 0 0 1 0.334 121.258 A 73.133 73.133 0 0 1 0 114.2 Q 0 105.4 1.6 93.1 A 108.565 108.565 0 0 1 5.359 75.813 A 130.72 130.72 0 0 1 8.1 67.7 A 78.018 78.018 0 0 1 21.594 44.808 A 88.696 88.696 0 0 1 22.8 43.4 Q 30.702 34.435 46.915 19.466 A 978.975 978.975 0 0 1 58 9.4 A 237.142 237.142 0 0 1 63.325 4.844 A 266.537 266.537 0 0 1 65.2 3.3 A 25.636 25.636 0 0 1 67.134 1.858 Q 69.141 0.515 70.75 0.136 A 5.571 5.571 0 0 1 71.6 0 A 2.879 2.879 0 0 1 72.392 0.099 Q 73.6 0.446 73.6 2 Q 68.6 9.4 63.2 15.5 Q 57.8 21.6 51.4 28.3 A 737.517 737.517 0 0 0 46.319 33.677 Q 44.084 36.064 41.655 38.694 A 1315.019 1315.019 0 0 0 36.6 44.2 Q 31.6 51.4 28.9 60 Q 26.2 68.6 25.3 76.8 A 177.115 177.115 0 0 0 24.752 82.641 Q 24.532 85.522 24.449 88.067 A 90.768 90.768 0 0 0 24.4 91 A 89.5 89.5 0 0 0 25.568 105.139 A 107.784 107.784 0 0 0 26.9 112 Q 29.4 123 35 132.6 Q 40.6 142.2 49.6 148.2 A 34.794 34.794 0 0 0 62.128 153.285 A 48.639 48.639 0 0 0 71.8 154.2 A 73.905 73.905 0 0 0 80.067 153.771 Q 89.867 152.664 95.2 148.7 Q 102.6 143.2 102.6 129 Q 102.6 119.8 87.6 95 A 58.449 58.449 0 0 1 89.141 93.653 Q 90.894 92.168 93.347 90.272 A 193.139 193.139 0 0 1 93.7 90 Q 97.6 87 101.8 84 A 1290.399 1290.399 0 0 1 104.781 81.877 Q 107.125 80.213 109 78.9 A 345.124 345.124 0 0 1 109.709 78.405 Q 112.05 76.775 112.4 76.6 A 93.563 93.563 0 0 1 119.308 86.53 A 84.458 84.458 0 0 1 120.4 88.4 Q 123.8 94.4 127.1 99.5 Q 130.4 104.6 134.4 107.7 A 14.556 14.556 0 0 0 140.845 110.498 A 20.027 20.027 0 0 0 144.4 110.8 A 20.056 20.056 0 0 0 146.064 110.723 Q 147.817 110.576 150.203 110.148 A 76.213 76.213 0 0 0 151 110 Q 155.2 109.2 159.3 107.7 A 20.197 20.197 0 0 0 161.514 106.748 Q 163.875 105.547 165 104 Q 162.72 102.1 159.175 99.297 A 552.961 552.961 0 0 0 158.8 99 A 94.468 94.468 0 0 1 153.1 94.107 A 108.372 108.372 0 0 1 151.2 92.3 A 53.391 53.391 0 0 1 147.762 88.64 A 39.281 39.281 0 0 1 145 85 A 49.158 49.158 0 0 1 141.761 79.297 A 36.78 36.78 0 0 1 139.6 73.7 Q 138 68.2 138 62.2 A 20.871 20.871 0 0 1 138.413 58.215 Q 139.016 55.122 140.5 51.5 A 36.697 36.697 0 0 1 143.712 45.447 Q 145.756 42.3 148.6 39.1 A 45.898 45.898 0 0 1 155.976 32.487 A 61.616 61.616 0 0 1 163.2 28 A 90.746 90.746 0 0 1 163.675 27.907 Q 164.35 27.775 164.8 27.7 A 17.848 17.848 0 0 1 165.043 27.661 Q 165.373 27.611 165.538 27.602 A 1.174 1.174 0 0 1 165.6 27.6 A 18.268 18.268 0 0 1 172.197 28.889 Q 174.492 29.772 176.831 31.262 A 32.46 32.46 0 0 1 177.5 31.7 A 29.808 29.808 0 0 1 184.645 38.546 A 38.426 38.426 0 0 1 187.7 43.3 A 32.638 32.638 0 0 1 191.123 53.224 A 44.828 44.828 0 0 1 191.8 61.2 A 47.287 47.287 0 0 1 191.181 69.066 Q 190.412 73.624 188.686 77.356 A 26.759 26.759 0 0 1 187.4 79.8 A 8.268 8.268 0 0 0 188.379 80.625 Q 189.443 81.4 191.049 82.176 A 27.14 27.14 0 0 0 191.1 82.2 A 11.515 11.515 0 0 0 193.851 83.096 Q 195.098 83.343 196.53 83.39 A 20.686 20.686 0 0 0 197.2 83.4 A 21.545 21.545 0 0 0 201.807 82.939 Q 204.743 82.296 206.923 80.757 A 12.114 12.114 0 0 0 209 78.9 A 14.844 14.844 0 0 0 211.215 75.462 Q 212.963 71.833 214.024 66.06 A 75.262 75.262 0 0 0 214.6 62.4 A 14.197 14.197 0 0 1 214.963 60.301 Q 215.602 57.84 217.089 57.015 A 3.469 3.469 0 0 1 218.8 56.6 Q 221.8 56.6 221.8 61.6 Q 221.8 69.046 219.6 74.527 A 24.386 24.386 0 0 1 219 75.9 A 40.769 40.769 0 0 1 215.715 81.633 A 32.19 32.19 0 0 1 212.3 85.8 Q 208.4 89.8 205.2 93 Q 196.2 102 188.9 104.5 A 51.581 51.581 0 0 1 182.814 106.198 Q 179.714 106.85 176.889 106.972 A 29.829 29.829 0 0 1 175.6 107 A 15.494 15.494 0 0 1 174.854 106.984 Q 173.811 106.933 173.389 106.728 A 0.693 0.693 0 0 1 173.2 106.6 Q 171.617 107.233 169.534 109.808 A 32.557 32.557 0 0 0 168.4 111.3 Q 165.6 115.2 162.1 119.6 A 30.404 30.404 0 0 1 158.826 123.136 A 22.019 22.019 0 0 1 154.6 126.2 A 42.17 42.17 0 0 1 140.834 131.922 Q 135.215 133.216 128.685 133.377 A 76.141 76.141 0 0 1 126.8 133.4 Q 123.4 132.8 121.6 132.6 A 78.653 78.653 0 0 0 120.87 132.522 Q 119.669 132.4 119.2 132.4 A 13.354 13.354 0 0 0 118.149 132.439 Q 117.071 132.524 116.423 132.8 A 1.951 1.951 0 0 0 115.8 133.2 Z M 176.6 73.6 L 177.2 69.4 Q 174.644 48.635 168.006 44.454 A 6.644 6.644 0 0 0 164.4 43.4 A 7.72 7.72 0 0 0 162.472 43.626 A 5.095 5.095 0 0 0 159.6 45.5 A 7.46 7.46 0 0 0 158.317 48.23 Q 158 49.486 158 51 Q 158 54 161.5 59.9 A 39.614 39.614 0 0 0 166.608 66.66 A 51.209 51.209 0 0 0 171.2 71 Q 174.4 73.6 176.6 73.6 Z" 
                            // vectorEffect="non-scaling-stroke"
                            // initial={{ opacity: 1, pathLength: 0 }}
                            // animate={{ opacity: 1, pathLength: 1 }}
                            // transition={{ duration: 2, delay: 3 }}
                            // onAnimationComplete={(animation) => {
                            //     console.log("animation complete (path length", animation)
                            // }}
                        />
                    {/* </g> */}
                </svg>

            </div>
            <div
                key='glyph-component'
                className={styles.glyphContainer}
                >
                <div className={styles.glyphContainerInner}>
                    <motion.div 
                        key="glyph-darkening"
                        className={styles.glyphContainerDarkening}
                        initial={{ opacity: 0 }}
                        animate={{ opacity: glyphControls.visible ? 1 : 0 }}
                        exit={{ opacity: 0 }}
                        transition={{ duration: glyphControls.immediate ? 0 : (glyphControls.duration || 4), delay: glyphControls.delay || 0 }}
                    />
                </div>    
            </div>
        </>
        )}
        </AnimatePresence>
        </>
    )
}